<app-sidebar></app-sidebar>
<div class="notifications-container page-bg">
  <!-- Header Mobile First -->
  <div class="notifications-header">
    <div class="notifications-header-content">
      <h1 class="notifications-title">
        Notificações
        <span *ngIf="getUnreadCount() > 0" class="notifications-badge">{{ getUnreadCount() }}</span>
      </h1>
      <button *ngIf="isAdminOrTeacher" (click)="openModal()" class="notifications-add-btn">
        <span class="material-icons">add</span>
        <span class="notifications-add-text">Nova Notificação</span>
      </button>
    </div>
  </div>

  <!-- Filtros Mobile First -->
  <div class="notifications-filters">
    <div class="notifications-search">
      <div class="notifications-search-wrapper">
        <span class="notifications-search-icon">
          <span class="material-icons">search</span>
        </span>
        <input type="text" [(ngModel)]="searchText" placeholder="Buscar notificações..." class="notifications-search-input" />
      </div>
    </div>
    
    <div class="notifications-filter-row">
      <div class="notifications-filter-field">
        <label class="notifications-filter-label">Tipo</label>
        <select [(ngModel)]="filterType" class="notifications-filter-select">
          <option value="ALL">Todos os tipos</option>
          <option value="AVISO">Aviso</option>
          <option value="TAREFA">Tarefa</option>
          <option value="SISTEMA">Sistema</option>
          <option value="FORUM">Fórum</option>
        </select>
      </div>
      
      <div class="notifications-filter-field">
        <label class="notifications-filter-label">Status</label>
        <select [(ngModel)]="filterRead" class="notifications-filter-select">
          <option value="ALL">Todas</option>
          <option value="UNREAD">Não lidas</option>
          <option value="READ">Lidas</option>
        </select>
      </div>
    </div>
  </div>
  <!-- Lista de Notificações Mobile First -->
  <div class="notifications-list">
    <div *ngIf="loading" class="notifications-loading">
      <span class="material-icons">refresh</span>
      Carregando...
    </div>
    
    <div *ngIf="!loading && notifications.length === 0" class="notifications-empty">
      <span class="material-icons">notifications_none</span>
      Nenhuma notificação encontrada
    </div>
    
    <div *ngIf="!loading && notifications.length > 0" class="notifications-cards">
      <div *ngFor="let n of filteredNotifications" 
           class="notification-card" 
           [class.notification-read]="n.isRead" 
           (click)="markAsRead(n)">
        
        <!-- Header do Card -->
        <div class="notification-card-header">
          <div class="notification-card-icon" [ngClass]="getNotifTypeColor(n.notificationType)">
            <span class="material-icons">{{ getNotifTypeIcon(n.notificationType) }}</span>
          </div>
          <div class="notification-card-info">
            <h3 class="notification-card-title">{{ n.title || 'Notificação' }}</h3>
            <span class="notification-card-date">{{ n.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
          </div>
          <div class="notification-card-status">
            <span *ngIf="!n.isRead" class="notification-status-new">Nova</span>
            <span *ngIf="n.isRead" class="notification-status-read">Lida</span>
          </div>
        </div>

        <!-- Body do Card -->
        <div class="notification-card-body">
          <p class="notification-card-message">{{ n.message }}</p>
        </div>

        <!-- Footer do Card -->
        <div class="notification-card-footer">
          <span [ngClass]="getNotifTypeColor(n.notificationType)" class="notification-type-badge">
            {{ getNotifTypeLabel(n.notificationType) }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Nova Notificação Mobile First -->
  <div *ngIf="showModal && isAdminOrTeacher" class="notification-modal">
    <div class="notification-modal-overlay" (click)="closeModal()"></div>
    <div class="notification-modal-content">
      <div class="notification-modal-header">
        <h2 class="notification-modal-title">Nova Notificação</h2>
        <button (click)="closeModal()" class="notification-modal-close">
          <span class="material-icons">close</span>
        </button>
      </div>
      
      <form (ngSubmit)="sendNotification()" autocomplete="off" class="notification-modal-form">
        <div class="notification-form-field">
          <label class="notification-form-label">Destinatário</label>
          <div class="notification-form-radio-group">
            <label class="notification-form-radio">
              <input type="radio" name="recipientType" [(ngModel)]="recipientType" value="USER" />
              <span class="notification-form-radio-text">Usuário</span>
            </label>
            <label class="notification-form-radio">
              <input type="radio" name="recipientType" [(ngModel)]="recipientType" value="CLASSROOM" />
              <span class="notification-form-radio-text">Turma</span>
            </label>
          </div>
          
          <div *ngIf="recipientType === 'USER'" class="notification-form-select-wrapper">
            <select [(ngModel)]="selectedUserId" name="selectedUserId" required class="notification-form-select">
              <option [ngValue]="null">Selecione o usuário</option>
              <option *ngFor="let u of users" [ngValue]="u.id">{{ u.email }}</option>
            </select>
          </div>
          
          <div *ngIf="recipientType === 'CLASSROOM'" class="notification-form-select-wrapper">
            <select [(ngModel)]="selectedClassroomId" name="selectedClassroomId" required class="notification-form-select">
              <option [ngValue]="null">Selecione a turma</option>
              <option *ngFor="let c of classrooms" [ngValue]="c.id">{{ c.name }}</option>
            </select>
          </div>
        </div>
        
        <div class="notification-form-field">
          <label class="notification-form-label">Título</label>
          <input [(ngModel)]="newNotification.title" name="title" required class="notification-form-input" placeholder="Digite o título da notificação" />
        </div>
        
        <div class="notification-form-field">
          <label class="notification-form-label">Mensagem</label>
          <textarea [(ngModel)]="newNotification.message" name="message" required rows="4" class="notification-form-textarea" placeholder="Digite a mensagem da notificação"></textarea>
        </div>
        
        <div class="notification-form-field">
          <label class="notification-form-label">Tipo</label>
          <select [(ngModel)]="newNotification.notificationType" name="notificationType" required class="notification-form-select">
            <option value="AVISO">Aviso</option>
            <option value="TAREFA">Tarefa</option>
            <option value="FORUM">Fórum</option>
            <option value="SISTEMA">Sistema</option>
          </select>
        </div>
        
        <div *ngIf="sendError" class="notification-form-error">{{ sendError }}</div>
        
        <div class="notification-form-actions">
          <button type="button" (click)="closeModal()" class="notification-form-cancel">
            Cancelar
          </button>
          <button type="submit" class="notification-form-submit">
            <span class="material-icons">send</span>
            Enviar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
